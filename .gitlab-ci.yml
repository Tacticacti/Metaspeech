image: node:20.0.0

# cache: #  Parameter 'cache' to cache the installation files for your projects dependencies, for building faster
#   paths:
#     - graphgadget/

stages:
  - prepare
  - build
  - test
  - deploy
prepare:
  stage: prepare
  script:
    - cd graphgadget
    - export NODE_ENV=development
    - npm ci
  artifacts:
   paths:
   - graphgadget/node_modules 
  cache:
   paths:
   - graphgadget/node_modules

build:
  stage: build
  script:
    - cd graphgadget
    - npm run build
  artifacts:
   paths: 
     - graphgadget/build



test:
  stage: test
  script: 
    - cd graphgadget
    - npx playwright install --with-deps
    - npm run test

pages:
  stage: deploy
  script:
  - mkdir .public
  - cp -r graphgadget/build/* .public
  - mv .public public
  artifacts:
    paths:
    - public
  only:
    - dev
